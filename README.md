# EvoFace - ä¼æ¥­ç´š AI äººè‡‰è¾¨è­˜è€ƒå‹¤ç³»çµ±
### Enterprise AI Face Recognition Attendance System

![Python](https://img.shields.io/badge/Python-3.10%2B-blue) ![PySide6](https://img.shields.io/badge/GUI-PySide6-green) ![InsightFace](https://img.shields.io/badge/AI-InsightFace-orange) ![SQLite](https://img.shields.io/badge/Database-SQLite%20(WAL)-lightgrey)

EvoFace æ˜¯ä¸€å¥—æ•´åˆ **å³æ™‚äººè‡‰è¾¨è­˜**ã€**æ´»é«”é˜²å½åµæ¸¬** èˆ‡ **è‡ªå‹•åŒ–è€ƒå‹¤è¨ˆç®—** çš„å…¨æ–¹ä½è§£æ±ºæ–¹æ¡ˆã€‚
ç³»çµ±æ¡ç”¨ **InsightFace (ArcFace)** ä½œç‚ºè¾¨è­˜æ ¸å¿ƒï¼Œçµåˆ **Silent-Face (MiniFASNet)** é€²è¡Œé˜²å½ï¼Œä¸¦é‡å°ä¼æ¥­è½åœ°éœ€æ±‚é€²è¡Œäº† **è³‡æ–™åº«ä½µç™¼å„ªåŒ– (WAL Mode)** èˆ‡ **éåŒæ­¥å¤šåŸ·è¡Œç·’æ¶æ§‹ (QThread)** æ”¹é€ ï¼Œç¢ºä¿åœ¨é«˜è² è¼‰æ‰“å¡å ´æ™¯ä¸‹çš„ç©©å®šæ€§èˆ‡æµæš¢åº¦ã€‚

EvoFace is a comprehensive solution integrating **Real-time Face Recognition**, **Liveness Detection**, and **Automated Attendance Calculation**.
Powered by **InsightFace (ArcFace)** and **Silent-Face (MiniFASNet)**, it features **database concurrency optimization (WAL Mode)** and **asynchronous multi-threading architecture**, ensuring stability and smoothness in high-load scenarios.

## ğŸŒŸ æ ¸å¿ƒåŠŸèƒ½èˆ‡æŠ€è¡“äº®é» (Key Features & Tech Highlights)

### 1. ä¼æ¥­ç´šé«˜æ•ˆèƒ½æ¶æ§‹ (Enterprise Performance)
- **éåŒæ­¥å¤šåŸ·è¡Œç·’ (Asynchronous Multi-threading)**ï¼š
  - æ¡ç”¨ **Producer-Consumer æ¨¡å¼**ï¼Œå°‡ç¹é‡çš„ AI è¾¨è­˜é‹ç®—ç§»è‡³ç¨ç«‹çš„ `RecognitionWorker` (QThread)ï¼Œç¢ºä¿ UI ä»‹é¢åœ¨åƒäººè¦æ¨¡æ¨è«–ä¸‹ä¾ç„¶ä¿æŒæ¥µè‡´æµæš¢ã€‚
- **è³‡æ–™åº«é«˜ä½µç™¼æ§åˆ¶ (WAL Mode)**ï¼š
  - å•Ÿç”¨ SQLite çš„ **Write-Ahead Logging (WAL)** æ¨¡å¼ï¼Œå¯¦ç¾è®€å¯«åˆ†é›¢ã€‚å‰å°å“¡å·¥æ‰“å¡çš„åŒæ™‚ï¼Œå¾Œå°ç®¡ç†å“¡å¯å³æ™‚æŸ¥è©¢å ±è¡¨ï¼Œå¾¹åº•è§£æ±ºå‚³çµ± SQLite çš„é–æ­» (Locking) å•é¡Œã€‚

### 2. æ™ºæ…§è¾¨è­˜èˆ‡é˜²èª¤åˆ¤æ©Ÿåˆ¶ (Intelligent Recognition)
- **é›™é‡å¼•æ“é©—è­‰**ï¼š
  - ç¬¬ä¸€é“é˜²ç·šï¼š**MediaPipe** é€²è¡Œæ¯«ç§’ç´šäººè‡‰å®šä½èˆ‡è¿½è¹¤ã€‚
  - ç¬¬äºŒé“é˜²ç·šï¼š**InsightFace (Buffalo_L)** æå– 512 ç¶­ç‰¹å¾µå‘é‡ï¼Œé€éçŸ©é™£åŒ– (Vectorization) é‹ç®—å¯¦ç¾ç²¾æº–æ¯”å°ã€‚
- **çŒ¶è±«æ©Ÿåˆ¶ (Ambiguity Detection)**ï¼š
  - å¼•å…¥ **Top-2 Gap Analysis**ï¼Œç•¶å‰å…©åå€™é¸äººåˆ†æ•¸å·®è·éå° (<0.05) æ™‚ï¼Œç³»çµ±è‡ªå‹•é€²å…¥ã€ŒçŒ¶è±«æ¨¡å¼ã€ä¸¦æç¤ºä½¿ç”¨è€…èª¿æ•´è§’åº¦ï¼Œæœ‰æ•ˆé˜²æ­¢é•·ç›¸ç›¸ä¼¼è€…çš„èª¤åˆ¤ã€‚
- **æƒ…å¢ƒæ„ŸçŸ¥å†·å» (Context-Aware Cooldown)**ï¼š
  - å…·å‚™æ™ºæ…§ Debounce é‚è¼¯ã€‚ç•¶å“¡å·¥æ‰“å¡å¾Œé€—ç•™ï¼ˆå³ä½¿å› é®æ“‹å°è‡´åˆ†æ•¸ä¸‹é™ï¼‰ï¼Œç³»çµ±èƒ½è­˜åˆ¥èº«åˆ†ä¸¦å‹å–„æç¤ºã€Œæ‰“å¡éæ–¼é »ç¹ã€ï¼Œè€ŒééŒ¯èª¤è·³å‡ºã€Œèº«åˆ†é©—è­‰å¤±æ•—ã€è¦–çª—ã€‚

### 3. å‹•æ…‹ç‰¹å¾µæ¼”é€² (Dynamic Evolution)
- **è‡ªé©æ‡‰æ¬Šé‡èåˆ**ï¼š
  - ç³»çµ±æœƒè‡ªå‹•æ•æ‰å“¡å·¥çš„é«˜ä¿¡å¿ƒåº¦æ‰“å¡ç…§ç‰‡ï¼Œä»¥ **0.1 (Alpha)** çš„æ¬Šé‡æŸ”å’Œæ›´æ–° **å“¡å·¥å‹•æ…‹ç‰¹å¾µ (Dynamic Features)**ã€‚
- **è¨˜æ†¶é«”ç†±æ›´æ–° (Hot-Update)**ï¼š
  - æ¼”é€²å¾Œçš„ç‰¹å¾µå³æ™‚åŒæ­¥è‡³ RAMï¼Œç„¡éœ€é‡å•Ÿç³»çµ±å³å¯ç”Ÿæ•ˆï¼Œè®“ç³»çµ±éš¨è‘—æ™‚é–“ã€Œè¶Šç”¨è¶Šæº–ã€ï¼Œè‡ªå‹•é©æ‡‰é«®å‹æˆ–æ¨£è²Œçš„å¾®å°è®ŠåŒ–ã€‚

### 4. å½ˆæ€§è€ƒå‹¤èˆ‡é›™å¹³å°ä»‹é¢
- **ä¸‰ç­åˆ¶èˆ‡è·¨æ—¥æ”¯æ´**ï¼šå…§å»ºæ—©ç­ã€æ™šç­ã€å¤§å¤œç­é‚è¼¯ï¼Œå®Œç¾æ”¯æ´ **è·¨æ—¥æ‰“å¡** (å¦‚ 16:00 ä¸Šç­ï¼Œéš”æ—¥ 01:00 ä¸‹ç­)ã€‚
- **ç®¡ç†ç«¯ (Admin Dashboard - PySide6)**ï¼š
  - æ”¯æ´ **ç…§ç‰‡æª”æ¡ˆè¨»å†Š (File Upload)ï¼ˆä¸å¼·åˆ¶ç¾å ´æ‹ç…§ï¼‰**ã€è€ƒå‹¤è£œç™»ç°½æ ¸ã€å ±è¡¨ Excel åŒ¯å‡ºã€‚
- **å“¡å·¥ç«¯ (Web Portal - Streamlit)**ï¼š
  - å“¡å·¥å¯é€éç€è¦½å™¨ (Web) è‡ªåŠ©æŸ¥è©¢å€‹äººè€ƒå‹¤ç´€éŒ„èˆ‡ç”³è«‹è£œç™»ã€‚

---

## ğŸ› ï¸ å®‰è£èˆ‡ç’°å¢ƒè¨­å®š (Installation)

### 1. ç³»çµ±éœ€æ±‚
- Python 3.10+
- å»ºè­°ä½¿ç”¨ NVIDIA GPU (éœ€å®‰è£ CUDA) ä»¥ç²å¾—æœ€ä½³æ•ˆèƒ½ï¼Œæœ¬ç³»çµ±äº¦é‡å° CPU é€²è¡Œäº† ONNX Runtime æœ€ä½³åŒ–ã€‚
- ç¶²è·¯æ”å½±æ©Ÿ (Webcam)

### 2. å®‰è£æ­¥é©Ÿ

```bash
# 1. ä¸‹è¼‰å°ˆæ¡ˆ
git clone https://github.com/chenkuanchung/evoface-attendance.git
cd evoface-attendance

# 2. å»ºç«‹è™›æ“¬ç’°å¢ƒ (å»ºè­°)
python -m venv .venv
# Windows å•Ÿç”¨:
.venv\Scripts\activate
# Mac/Linux å•Ÿç”¨:
source .venv/bin/activate

# 3. å®‰è£ä¾è³´å¥—ä»¶
pip install -r requirements.txt
```

---

## ğŸš€ å¿«é€Ÿå•Ÿå‹• (Usage)

æœ¬ç³»çµ±å·²æ•´åˆ **å‰å°æ‰“å¡ç«¯**ã€**å“¡å·¥è‡ªåŠ©ç¶²é ** èˆ‡ **å¾Œå°ç®¡ç†ç«¯**ï¼Œå»ºè­°ç›´æ¥ä½¿ç”¨å…§å»ºçš„æ‰¹æ¬¡æª” (Batch File) ä¸€éµå•Ÿå‹•ã€‚

### ğŸŸ¢ å•Ÿå‹•è€ƒå‹¤ä¸»ç³»çµ± (æ‰“å¡é˜ + å“¡å·¥ç¶²é )
è«‹åŸ·è¡Œ `Start_System.bat`ï¼Œç³»çµ±å°‡è‡ªå‹•ä¸¦è¡Œå•Ÿå‹•ä»¥ä¸‹å…©é …æœå‹™ï¼š

1.  **äººè‡‰è¾¨è­˜ä¸»è¦–çª— (PySide6)**ï¼š
    - é€™æ˜¯æ”¾ç½®æ–¼å…¬å¸é–€å£çš„æ‰“å¡çµ‚ç«¯æ©Ÿä»‹é¢ã€‚
    - å•Ÿå‹•å¾Œè«‹ç­‰å¾…æ”å½±æ©Ÿé ç†±ï¼Œå“¡å·¥å³å¯é–‹å§‹åˆ·è‡‰æ‰“å¡ã€‚

2.  **å“¡å·¥è€ƒå‹¤æŸ¥è©¢ç¶²é  (Streamlit)**ï¼š
    - å•Ÿå‹•å¾Œç€è¦½å™¨æœƒè‡ªå‹•é–‹å•Ÿï¼Œå“¡å·¥å¯æŸ¥è©¢å€‹äººç´€éŒ„ã€‚
    - **æœ¬æ©Ÿå­˜å–**ï¼š`http://localhost:8501`
    - **å€ç¶²å­˜å–**ï¼šåŒè¾¦å…¬å®¤çš„å…¶ä»–é›»è…¦æˆ–æ‰‹æ©Ÿï¼Œå¯è¼¸å…¥ `http://<ä¸»æ©ŸIP>:8501` é€²è¡Œé ç«¯æŸ¥è©¢ã€‚

### ğŸ”µ å•Ÿå‹•ç®¡ç†å¾Œå° (Admin)
è«‹åŸ·è¡Œ `Start_Admin.bat`
- é–‹å•Ÿå¾Œå°ç®¡ç†è¦–çª—ï¼Œæä¾› **å“¡å·¥è³‡æ–™è¨»å†Š**ã€**è€ƒå‹¤è£œç™»ç°½æ ¸** èˆ‡ **è€ƒå‹¤å ±è¡¨åŒ¯å‡º** åŠŸèƒ½ã€‚
- **âš ï¸ æ³¨æ„**ï¼šé¦–æ¬¡éƒ¨ç½²ç³»çµ±æ™‚ï¼Œè«‹å‹™å¿…å…ˆé€²å…¥æ­¤å¾Œå°å®Œæˆå“¡å·¥å»ºæª”ã€‚
- *(è¨»ï¼šç­è¡¨æ™‚é–“è¦å‰‡è«‹æ–¼ `config.yaml` ä¸­è¨­å®š)*

### ğŸŸ  è³‡æ–™å‚™ä»½ (Backup)
è«‹åŸ·è¡Œ `Backup_Data.bat`
- ç³»çµ±æœƒè‡ªå‹•å°‡æ ¸å¿ƒè³‡æ–™åº« (`attendance.db`) å®Œæ•´å‚™ä»½è‡³ `backup/` è³‡æ–™å¤¾ï¼Œä¸¦è‡ªå‹•åŠ ä¸Šæ™‚é–“æˆ³è¨˜ (Timestamp)ã€‚
- **å»ºè­°æ’ç¨‹**ï¼šå»ºè­°æ¯é€±äº”ä¸‹ç­å¾Œæˆ–ç³»çµ±æ›´æ–°å‰åŸ·è¡Œä¸€æ¬¡ï¼Œç¢ºä¿è³‡æ–™å®‰å…¨ã€‚

---

## âš™ï¸ æ ¸å¿ƒåƒæ•¸è¨­å®š (Configuration)

æ‰€æœ‰æ ¸å¿ƒåƒæ•¸çš†ä½æ–¼ `config.yaml`ï¼Œå¯ä¾å ´åŸŸéœ€æ±‚èª¿æ•´ï¼š

```yaml
system:
  device_mode: "auto"       # auto/gpu/cpu (æ¨è«–ç¡¬é«”è¨­å®šï¼Œauto ç‚ºè‡ªå‹•åµæ¸¬)
  camera_index: 0           # æ”å½±æ©Ÿç·¨è™Ÿ (è‹¥ä½¿ç”¨å¤–æ¥ Webcam å¯æ”¹ç‚º 1)

attendance:
  debounce_minutes: 1       # é˜²æ­¢é‡è¤‡æ‰“å¡é–“éš” (åˆ†é˜)
  day_cutoff: "04:00"       # æ¯æ—¥æ›æ—¥çµç®—é» (å‡Œæ™¨ 4 é»å‰æ‰“å¡ç®—ã€Œæ˜¨å¤©ã€)

# ä¸‰ç­åˆ¶æ™‚é–“å®šç¾© (è«‹åœ¨æ­¤èª¿æ•´ç­è¡¨è¦å‰‡)
shifts:
  morning:
    name: "æ—©ç­"
    start_time: "08:00"
    end_time: "17:00"
    range_start: "05:00"    # è‡ªå‹•åˆ¤å®šå€é–“ï¼šåœ¨æ­¤æ™‚é–“å¾Œæ‰“å¡è¦–ç‚ºæ—©ç­
    range_end: "11:00"

  evening:
    name: "æ™šç­"
    start_time: "16:00"
    end_time: "01:00"       # æ”¯æ´è·¨æ—¥è¨­å®š
    range_start: "13:00"
    range_end: "19:00"

  night:
    name: "å¤§å¤œç­"
    start_time: "00:00"
    end_time: "09:00"
    range_start: "21:00"
    range_end: "03:00"

thresholds:
  recognition_confidence: 0.5  # è¾¨è­˜ä¿¡å¿ƒé–€æª» (ä½æ–¼æ­¤å€¼è¦–ç‚ºé™Œç”Ÿäºº)
  ambiguity_gap: 0.05          # çŒ¶è±«å€é–“ (Top-1 èˆ‡ Top-2 åˆ†æ•¸å·®è·å°æ–¼æ­¤å€¼æ™‚ï¼Œæ‹’çµ•è¾¨è­˜)
  texture_liveness: 0.98       # æ´»é«”é˜²å½åš´æ ¼åº¦ (å»ºè­°å€¼ 0.95~0.99ï¼Œè¶Šé«˜è¶Šåš´)
  warning_base_score: 0.4      # åŸå§‹è­‰ä»¶ç…§ç›¸ä¼¼åº¦éä½è­¦å‘Š (æç¤ºå¯èƒ½ç‚ºä¸åŒäººæˆ–é®æ“‹åš´é‡)
  evolution_min_base: 0.5      # ç‰¹å¾µæ¼”é€²æ¢ä»¶ï¼šéœ€èˆ‡åŸå§‹è­‰ä»¶ç…§ä¿æŒä¸€å®šç›¸ä¼¼åº¦
  evolution_min_dynamic: 0.85  # ç‰¹å¾µæ¼”é€²æ¢ä»¶ï¼šéœ€èˆ‡æ˜¨æ—¥å‹•æ…‹ç‰¹å¾µé«˜åº¦ç›¸ä¼¼

recognition:
  min_face_ratio: 0.15         # æœ€å°äººè‡‰ä½”æ¯” (ä½æ–¼æ­¤æ¯”ä¾‹è¦–ç‚ºéé ï¼Œä¸é€²è¡Œåµæ¸¬)
  base_weight: 0.3             # åŸå§‹è­‰ä»¶ç…§æ¬Šé‡
  dynamic_weight: 0.7          # å‹•æ…‹ç‰¹å¾µæ¬Šé‡ (æ¬Šé‡è¶Šé«˜è¶Šèƒ½é©æ‡‰æˆ´å£ç½©æˆ–é€ å‹è®ŠåŒ–)
```

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹ (Project Structure)

```plaintext
evoface-attendance/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ attendance.db      # SQLite è³‡æ–™åº«
â”‚   â”œâ”€â”€ faces/             # å“¡å·¥è¨»å†Šåº•åœ–
â”‚   â””â”€â”€ logs/              # æ‰“å¡ç¾å ´å¿«ç…§
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ liveness/          # Silent-Face æ´»é«”åµæ¸¬æ¨¡å‹
â”‚   â””â”€â”€ face_landmarker.task   # MediaPipe äººè‡‰é—œéµé»æ¨¡å‹
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ core/              # [æ ¸å¿ƒ] ç³»çµ±é‚è¼¯å±¤
â”‚   â”‚   â”œâ”€â”€ calculator.py  # è€ƒå‹¤èˆ‡å·¥æ™‚è¨ˆç®—é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ database.py    # è³‡æ–™åº« CRUD æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ detector.py    # MediaPipe äººè‡‰åµæ¸¬èˆ‡è¿½è¹¤
â”‚   â”‚   â”œâ”€â”€ liveness_engine.py # Silent-Face æ´»é«”é˜²å½å¼•æ“
â”‚   â”‚   â””â”€â”€ recognizer.py  # ArcFace è¾¨è­˜èˆ‡ç‰¹å¾µæ¼”é€²
â”‚   â”œâ”€â”€ ui/                # [ä»‹é¢] PySide6 è¦–çª—
â”‚   â”‚   â”œâ”€â”€ admin_window.py    # å¾Œå°ç®¡ç†ä»‹é¢
â”‚   â”‚   â””â”€â”€ main_window.py     # å‰å°æ‰“å¡ä¸»è¦–çª—
â”‚   â””â”€â”€ utils/             # [å·¥å…·] é€šç”¨æ¨¡çµ„
â”‚       â”œâ”€â”€ image_tool.py  # å½±åƒå°é½Šèˆ‡è£åˆ‡å·¥å…·
â”‚       â””â”€â”€ voice.py       # èªéŸ³æç¤ºåŠŸèƒ½
â”œâ”€â”€ admin.py               # [å…¥å£] ç®¡ç†å¾Œå°å•Ÿå‹•æª”
â”œâ”€â”€ main.py                # [å…¥å£] æ‰“å¡ç³»çµ±å•Ÿå‹•æª”
â”œâ”€â”€ webapp.py              # [å…¥å£] å“¡å·¥ç¶²é ç«¯
â”œâ”€â”€ config.yaml            # ç³»çµ±å…¨åŸŸè¨­å®šæª”
â”œâ”€â”€ requirements.txt       # Python ä¾è³´å¥—ä»¶æ¸…å–®
â”œâ”€â”€ Start_System.bat       # [è…³æœ¬] ä¸€éµå•Ÿå‹•ç³»çµ±
â”œâ”€â”€ Start_Admin.bat        # [è…³æœ¬] ä¸€éµå•Ÿå‹•å¾Œå°
â”œâ”€â”€ Backup_Data.bat        # [è…³æœ¬] è³‡æ–™åº«å‚™ä»½å·¥å…·
â”œâ”€â”€ README.md              # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
â””â”€â”€ LICENSE                # æˆæ¬Šæ¢æ¬¾
```

---

## ğŸ“ æˆæ¬Šèˆ‡è²æ˜

æœ¬å°ˆæ¡ˆåƒ…ä¾›å­¸è¡“ç ”ç©¶èˆ‡å…§éƒ¨ä½¿ç”¨ã€‚

- Face Detection model based on Google MediaPipe.

- Anti-Spoofing model based on MiniFASNet (Silent-Face).

- Recognition model based on InsightFace.

